{"version":3,"sources":["index.es6.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["// Drives the app\nclass App {\n\n  constructor() {\n    this.el = document.body\n    this.editing = false\n    this._filtered = ''\n\n    this.hammer()\n    this.build()\n    this.observe()\n\n    this.list = new List({\n      app: this\n    }).build()\n\n    this.list.render()\n  }\n\n  static uniqueId() {\n    this._counter = this._counter || 0\n    return ++this._counter\n  }\n\n  static escapeRegex(string) {\n    return string.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\")\n  }\n\n  static markdown(string) {\n    const tags = string.match(/\\S*#(?:\\[[^\\]]+\\]|\\S+)/g)\n\n    if (tags) {\n      tags.forEach(tag => {\n        string = string.replace(tag, `<span class=\"tag\">${tag}</span>`)\n      })\n    }\n\n    return marked(string)\n  }\n\n  // Examples:\n  // - January 12 - 19\n  // - January 12 - February 3\n  static formatWeekRange(range) {\n    const today = moment()\n    let fromFormat = 'MMMM D'\n    let toFormat = 'MMMM D'\n\n    if (range.from.month() === range.to.month()) {\n      toFormat = 'D'\n    }\n\n    const fromDate = range.from.format(fromFormat)\n    const toDate = range.to.format(toFormat)\n\n    return `${fromDate} - ${toDate}`\n  }\n\n  build() {\n    this.aside = document.createElement('aside')\n    this.el.appendChild(this.aside)\n  }\n\n  hammer() {\n    this.hammer = new Hammer.Manager(this.el, { domEvents: true })\n\n    const singleTap = new Hammer.Tap({ event: 'singletap', taps: 1 })\n    const doubleTap = new Hammer.Tap({ event: 'doubletap', taps: 2 })\n\n    this.hammer.add(doubleTap)\n    this.hammer.add(singleTap)\n  }\n\n  observe() {\n\n    // For regular keys, use `keypress` (provides the correct char code)\n    window.addEventListener('keypress', e => {\n      if (this.editing) return\n      if (e.metaKey) return\n      if (e.ctrlKey) return\n      if (e.altKey) return\n      if (e.which === 13) return\n\n      const char = String.fromCharCode(e.which)\n\n      if (!char) return\n\n      this.filtered += char\n    })\n\n    // For special keys (esc and backspace), use `keydown`\n    window.addEventListener('keydown', e => {\n      if (this.editing) return\n      if (e.metaKey) return\n      if (e.ctrlKey) return\n      if (e.altKey) return\n      if (e.shiftKey) return\n\n      if (e.which === 27) { // Esc\n        e.preventDefault()\n\n        if (document.activeElement) {\n          document.activeElement.blur()\n        }\n\n        this.filtered = ''\n        if (this.list.drake.dragging) {\n          this.list.drake.cancel(true)\n          if (this.list.originalSectionId) {\n            this.list.el.dataset.active = `#${this.list.originalSectionId}`\n          }\n        }\n      }\n\n      if (e.which === 8) { // Backspace\n        e.preventDefault()\n        this.filtered = this.filtered.slice(0, this.filtered.length - 1)\n      }\n    })\n\n  }\n\n  get filtered() {\n    return this._filtered\n  }\n\n  set filtered(value) {\n    this._filtered = value\n    this.aside.innerText = value\n    this.list.filter()\n  }\n\n}\n\n// Can have multiple lists, but only one is active\n// Lists hold all the items within\nclass List {\n\n  constructor(opts) {\n    if (opts.name) this.name = opts.name\n    this.app = opts.app\n    this.el = document.createElement('main')\n    this.items = {}\n  }\n\n  build() {\n    this.sections = [] // Ordered, for rendering sequentially\n    this.sectionById = {} // For easy lookup\n\n    const date = moment().startOf('day').subtract(1, 'day')\n    const days = ['today', 'tomorrow', 'day-after-tomorrow']\n\n    // Sundays are skipped, so if today is Sunday, pretend it's Saturday\n    if (moment().day() === 0) date.subtract(1, 'day')\n\n    this.el.dataset.active = ''\n\n    days.forEach(day => {\n      date.add(1, 'days')\n\n      if (date.day() === 0) {\n        // Skip Sundays\n        date.add(1, 'days')\n      }\n\n      const section = new DaySection({\n        list: this,\n        date: date,\n        sectionId: day\n      }).build()\n\n      section.render(this.el)\n\n      this.sections.push(section)\n      this.sectionById[section.id] = section\n    })\n\n\n    const sectionClasses = [ WeekSection, MonthSection, BacklogSection, OverdueSection, DoneSection ]\n\n    sectionClasses.forEach(SectionClass => {\n      const section = new SectionClass({\n        list: this\n      }).build()\n\n      section.render(this.el)\n\n      this.sections.push(section)\n      this.sectionById[section.id] = section\n    })\n\n    this.dragula()\n    this.load()\n\n    return this\n  }\n\n  dragula() {\n    const lists = this.sections.map(section => { return section.listEl })\n    const headers = this.sections.map(section => { return section.header })\n    const els = [...lists, ...headers]\n\n    this.drake = dragula({\n      containers: els,\n      mirrorContainer: this.el,\n      moves: (el, source, handle, sibling) => {\n        if (source.nodeName === 'HEADER') {\n          return false\n        }\n\n        if (!App.canDrag) {\n          return false\n        }\n\n        const item = this.items[el.dataset.id]\n\n        if (item.editing) {\n          return false\n        }\n\n        return true\n      },\n      accepts: (el, target, source, sibling) => {\n        const section = this.sectionById[target.parentElement.dataset.id]\n        const active = section.list.el.querySelector('section.over')\n\n        if (active) {\n          active.classList.remove('over')\n        }\n\n        section.el.classList.add('over')\n        this.el.dataset.active = `#${section.sectionId}`\n\n        if (target.nodeName === 'HEADER') {\n          if (target.parentElement === el.parentElement.parentElement) {\n            return false\n          }\n\n          section.listEl.insertBefore(el, section.listEl.firstChild)\n\n          return false\n        }\n\n        return true\n      }\n    })\n\n    this.drake.on('drag', (el) => {\n      this.originalSectionId = el.parentElement.parentElement.dataset.sectionId\n      el.parentElement.parentElement.classList.add('over')\n    })\n\n    this.drake.on('dragend', (el) => {\n      const active = this.el.querySelector('section.over')\n\n      if (active) {\n        active.classList.remove('over')\n      }\n    })\n\n    this.drake.on('drop', (el, target, source, sibling) => {\n      const item = this.items[el.dataset.id]\n      const section = this.sectionById[target.parentElement.dataset.id]\n      item.section = section\n    })\n\n    this.drake.on('cloned', (clone, original, type) => {\n      const color = getComputedStyle(original).backgroundColor\n      clone.style.boxShadow = `inset 0 0 0 50vw ${color}`\n      clone.classList.remove('enlarge')\n      original.classList.remove('enlarge')\n    })\n\n    this.drake.on('shadow', (el, container, source) => {\n      const mirror = this.el.querySelector('.item.gu-mirror')\n      mirror.dataset.sectionType = container.parentElement.dataset.name\n    })\n  }\n\n  load() {\n    const items = this.stored()\n\n    if (!items) return\n\n    items.forEach(item => {\n      let section = this.sectionById[item.group]\n\n      if (!section) {\n        section = this.sectionById.overdue\n      }\n\n      section.createItem({\n        content: item.content\n      })\n    })\n  }\n\n  stored() {\n    if (this._stored) {\n      return this._stored\n    }\n\n    const stored = localStorage.getItem('items')\n    if (!stored) return\n\n    let items = JSON.parse(stored)\n\n    // If `items` is a key/value object it needs to be converted to a simple array\n    if (!Array.isArray(items)) {\n      items = Object.keys(items).map(id => { return items[id] })\n    }\n\n    this._stored = items\n\n    return items\n  }\n\n  render() {\n    this.app.el.appendChild(this.el)\n  }\n\n  save() {\n    // Get order from the DOM\n    const els = this.el.querySelectorAll('.item:not(.gu-mirror)')\n    const ids = [...els].map(el => { return el.dataset.id })\n    const items = ids.map(id => { return this.items[id] })\n    const stringified = JSON.stringify(items)\n\n    this._stored = null\n    localStorage.setItem('items', stringified)\n  }\n\n  filter() {\n    const regex = new RegExp(App.escapeRegex(this.app.filtered), 'i')\n\n    Object.keys(this.items).forEach(id => {\n      const item = this.items[id]\n\n      if (regex.test(item.content)) {\n        item.show()\n      } else {\n        item.hide()\n      }\n    })\n  }\n\n}\n\n// Represents a visual group, and is where items get rendered\nclass Section {\n\n  constructor(opts) {\n    this.id = opts.id || opts.name\n    this.list = opts.list\n    this.name = opts.name\n    this.title = opts.name\n    this.sectionId = opts.sectionId\n    this.classes = new Set()\n    this.classes.add(opts.name)\n    this.classes.add(opts.sectionId)\n  }\n\n  build() {\n    const section = document.createElement('section')\n    const header = document.createElement('header')\n    const back = document.createElement('button')\n    const list = document.createElement('div')\n    section.appendChild(header)\n    section.appendChild(list)\n\n    section.dataset.id = this.id\n    section.dataset.name = this.name\n    section.dataset.sectionId = this.sectionId\n    this.classes.forEach(className => {\n      section.classList.add(className)\n    })\n\n    const emoji = this.emoji()\n    if (emoji) header.dataset.emoji = emoji\n    header.innerText = this.title\n    back.classList.add('back')\n    list.classList.add('list')\n    header.appendChild(back)\n\n    this.el = section\n    this.header = header\n    this.listEl = list\n\n    this.el.addEventListener('doubletap', e => {\n      if (e.target !== this.listEl && e.target !== this.header) return\n\n      const first = e.target !== this.listEl\n\n      this.createItem({\n        edit: true,\n        first: first\n      })\n    })\n\n    header.addEventListener('singletap', e => {\n      if (e.target !== header) return\n\n      this.list.el.dataset.active = `#${this.sectionId}`\n    })\n\n    back.addEventListener('singletap', e => {\n      if (e.target !== back) return\n\n      this.list.el.dataset.active = ''\n    })\n\n    return this\n  }\n\n  emoji() {\n\n  }\n\n  render(parent) {\n    parent.appendChild(this.el)\n  }\n\n  createItem(opts) {\n    opts.section = this\n\n    const item = new Item(opts).build()\n\n    item.render({ first: opts.first })\n\n    this.list.items[item.id] = item\n  }\n\n}\n\nclass DaySection extends Section {\n\n  constructor(opts) {\n    const date = opts.date\n    const today = moment().startOf('day')\n\n    if (today.day() === 0) {\n      today.subtract(1, 'day')\n    }\n\n    const isToday = date.isSame(today)\n    const isSaturday = date.day() === 6\n\n    opts.id = date.format('YYYY-MM-DD')\n    opts.name = 'day'\n    super(opts)\n\n    this.date = date\n    this.title = date.format('dddd')\n\n    if (isSaturday) {\n      this.classes.add('weekend')\n    }\n\n    if (isToday && isSaturday) {\n      this.title = 'This weekend'\n    } else if (isToday) {\n      this.title = 'Today'\n    } else if (isSaturday) {\n      this.title = 'Weekend'\n    }\n  }\n\n  build() {\n    super.build()\n\n    const today = moment().startOf('day')\n    let day = this.date.format('dddd')\n\n    if (this.date.isSame(today)) {\n      day = 'today'\n    }\n\n    if (this.date.day() === 6) {\n      day = 'the weekend'\n    }\n\n    this.listEl.dataset.day = day\n\n    return this\n  }\n\n}\n\nclass WeekSection extends Section {\n\n  constructor(opts) {\n    const dateStart = moment().startOf('week')\n    const dateEnd = moment().endOf('week')\n\n    opts.id = `${dateStart.format('YYYY-MM-DD')}-${dateEnd.format('YYYY-MM-DD')}`\n    opts.name = 'week'\n    opts.sectionId = 'week'\n    super(opts)\n\n    this.title = 'This week'\n  }\n\n  build() {\n    const dateStart = moment().startOf('week')\n    const dateEnd = moment().endOf('week')\n\n    super.build()\n\n    this.listEl.dataset.dates = App.formatWeekRange({ from: dateStart, to: dateEnd })\n\n    return this\n  }\n\n}\n\nclass MonthSection extends Section {\n\n  constructor(opts) {\n    const dateStart = moment().startOf('month')\n    const dateEnd = moment().endOf('month')\n\n    opts.id = `${dateStart.format('YYYY-MM-DD')}-${dateEnd.format('YYYY-MM-DD')}`\n    opts.name = 'month'\n    opts.sectionId = 'month'\n    super(opts)\n\n    this.title = 'This month'\n  }\n\n  build() {\n    const date = moment()\n\n    super.build()\n\n    this.listEl.dataset.date = date.format('MMMM')\n\n    return this\n  }\n\n}\n\nclass DoneSection extends Section {\n\n  constructor(opts) {\n    opts.name = 'done'\n    opts.sectionId = 'done'\n    super(opts)\n  }\n\n  emoji() {\n    return '😍'\n  }\n\n  build() {\n    super.build()\n\n    const button = document.createElement('button')\n\n    button.classList.add('clear')\n    button.innerText ='Clear'\n    this.el.appendChild(button)\n\n    button.addEventListener('singletap', e => {\n      this.clear()\n    })\n\n    return this\n  }\n\n  clear() {\n    Object.keys(this.list.items).forEach(id => {\n      const item = this.list.items[id]\n      if (item.section.id === this.id) {\n        item.remove()\n      }\n    })\n  }\n\n}\n\nclass OverdueSection extends Section {\n\n  constructor(opts) {\n    opts.name = 'overdue'\n    opts.sectionId = 'overdue'\n    super(opts)\n  }\n\n  emoji() {\n    return '😰'\n  }\n\n}\n\nclass BacklogSection extends Section {\n\n  constructor(opts) {\n    opts.name = 'backlog'\n    opts.sectionId = 'backlog'\n    super(opts)\n  }\n\n}\n\n// Items have an ID (not persisted) and text content and belong to a section\nclass Item {\n\n  constructor(opts) {\n    this.id = App.uniqueId()\n    this._editing = !!opts.edit\n    this._section = opts.section\n    this._content = opts.content || ''\n    this.list = this._section.list\n\n    this.onDblClick = this.onDblClick.bind(this)\n    this.onKeydown = this.onKeydown.bind(this)\n    this.onBlur = this.onBlur.bind(this)\n    this.onPaste = this.onPaste.bind(this)\n  }\n\n  get editing () {\n    return this._editing\n  }\n\n  set editing(value) {\n    this._editing = value\n    this.list.app.editing = value\n  }\n\n  get section () {\n    return this._section\n  }\n\n  set section(value) {\n    this._section = value\n    this.el.dataset.sectionId = value.name\n    this.list.save()\n  }\n\n  get content() {\n    return this._content\n  }\n\n  set content(value) {\n    this._content = value\n    this.list.save()\n  }\n\n  toJSON() {\n    return {\n      group: this.section.id,\n      content: this.content\n    }\n  }\n\n  build() {\n    const el = document.createElement('article')\n\n    el.classList.add('item')\n    el.dataset.sectionType = this.section.name\n    el.dataset.id = this.id\n    el.innerHTML = App.markdown(this.content)\n    el.tabIndex = 1\n\n    el.addEventListener('keydown', this.onKeydown)\n\n    el.addEventListener('touchstart', e => {\n      if ('_allowDrag' in this) return\n\n      App.canDrag = false\n\n      this._timer = setTimeout(() => {\n        this._allowDrag = App.canDrag = true\n        this.el.classList.add('enlarge')\n        this.el.dispatchEvent(e)\n        delete this._allowDrag\n      }, 500)\n    })\n\n    el.addEventListener('touchmove', e => {\n      clearTimeout(this._timer)\n    })\n\n    el.addEventListener('touchend', e => {\n      this.el.classList.remove('enlarge')\n    })\n\n    el.addEventListener('touchcancel', e => {\n      this.el.classList.remove('enlarge')\n    })\n\n    el.addEventListener('mousedown', e => {\n      App.canDrag = true\n    })\n\n    this.el = el\n\n    if (this.editing) {\n      this.startEditing()\n    } else {\n      this.awaitEditing()\n    }\n\n    return this\n  }\n\n  render(opts) {\n    if (opts.first) {\n      this.section.listEl.insertBefore(this.el, this.section.listEl.firstChild)\n    } else {\n      this.section.listEl.appendChild(this.el)\n    }\n\n    if (this.editing) {\n      this.el.focus()\n    }\n  }\n\n  detach() {\n    if (!this.el.parentElement) return\n    this.section.listEl.removeChild(this.el)\n  }\n\n  remove() {\n    this.detach()\n    delete this.list.items[this.id]\n    this.list.save()\n  }\n\n  show() {\n    this.el.style.display = ''\n  }\n\n  hide() {\n    this.el.style.display = 'none'\n  }\n\n  startEditing() {\n    this.editing = true\n    this.el.contentEditable = 'true'\n    this.el.innerText = this.content\n\n    if (this.el.parentElement) {\n      this.focus() // Ensure cursor is at end\n    } else {\n      this.el.focus()\n    }\n\n    this.el.removeEventListener('doubletap', this.onDblClick)\n    this.el.addEventListener('blur', this.onBlur)\n    this.el.addEventListener('paste', this.onPaste)\n  }\n\n  finishEditing() {\n    this.editing = false\n    this.content = this.el.innerText\n    this.el.contentEditable = 'false'\n    this.el.innerHTML = App.markdown(this.content)\n    this.el.removeEventListener('blur', this.onBlur)\n    this.el.removeEventListener('paste', this.onPaste)\n\n    if (this.el.innerText.replace(/\\s/g, '') === '') {\n      return this.remove()\n    }\n\n    this.awaitEditing()\n  }\n\n  cancelEditing() {\n    this.el.innerText = this.content\n    this.finishEditing()\n  }\n\n  awaitEditing() {\n    this.el.addEventListener('doubletap', this.onDblClick)\n  }\n\n  focus() {\n    this.el.focus()\n    const range = document.createRange()\n    range.selectNodeContents(this.el)\n    range.collapse(false)\n    const selection = window.getSelection()\n    selection.removeAllRanges()\n    selection.addRange(range)\n  }\n\n  onDblClick(e) {\n    this.startEditing()\n  }\n\n  onKeydown(e) {\n    if (e.which === 13) e.preventDefault()\n\n    if (this.editing) {\n      if (e.which === 27) this.cancelEditing() // Esc\n      if (e.which === 13 && !e.shiftKey) this.el.blur() // Enter\n    } else {\n      if (e.which === 13) this.startEditing() // Enter\n    }\n  }\n\n  onBlur(e) {\n    this.finishEditing()\n  }\n\n  onPaste(e) {\n    e.stopPropagation()\n    e.preventDefault()\n\n    const clipboardData = e.clipboardData || window.clipboardData\n    const pastedData = clipboardData.getData('Text')\n    const selection = window.getSelection()\n    const range = selection.getRangeAt(0)\n\n    range.deleteContents()\n    range.insertNode(document.createTextNode(pastedData))\n    this.focus()\n  }\n\n}\n\nApp.canDrag = true\n\nconst app = new App()\n"]}