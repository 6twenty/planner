{"version":3,"sources":["../index.es6.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["// Drives the app\nclass App {\n\n  constructor() {\n    this.el = document.body\n    this.editing = false\n    this._filtered = ''\n\n    if (navigator.standalone) {\n      this.el.classList.add('standalone')\n    }\n\n    const colorHash = new ColorHash({ lightness: [0.8, 0.85, 0.9], saturation: [0.8, 0.9, 1] })\n\n    App.hsl = (string) => {\n      let hsl = colorHash.hsl(string)\n\n      // Avoid hues in the blue range\n      if (hsl[0] > 200 && hsl[0] < 280) {\n        hsl = App.hsl(string + '_')\n      }\n\n      return hsl\n    }\n\n    App.canDrag = true\n\n    this.hammer()\n    this.build()\n    this.observe()\n\n    this.list = new List({\n      app: this\n    })\n\n    this.list.build()\n    this.list.render()\n\n    this.loading()\n    this.firebase().then(this.init.bind(this))\n  }\n\n  static uniqueId() {\n    this._counter = this._counter || 0\n    return ++this._counter\n  }\n\n  static escapeRegex(string) {\n    return string.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\")\n  }\n\n  static markdown(string) {\n    string = string.replace(/(^|\\s)(#(\\w+))\\b/g, (match, initial, hashtag) => {\n      const hsl = App.hsl(hashtag.replace('#', ''))\n      const color = `hsl(${hsl[0]}, ${hsl[1]*100}%, ${hsl[2]*100}%)`\n      return `${initial}<span style=\"color:${color}\">${hashtag}</span>`\n    })\n\n    let isWithinCodeBlock = false\n    const array = string.split('')\n    string = array.map((char, i) => {\n      const lastChar = array[i-1]\n      const nextChar = array[i+1]\n\n      if (isWithinCodeBlock) {\n        if (char === '`' && lastChar !== '`') {\n          isWithinCodeBlock = false\n        }\n      } else {\n        if (char === '`' && lastChar !== '`') {\n          isWithinCodeBlock = true\n        } else if (char === '-' && nextChar === '-') {\n          return ''\n        } else if (char === '-' && lastChar === '-') {\n          return '—'\n        }\n      }\n\n      return char\n    }).join('')\n\n    return marked(string)\n  }\n\n  // Examples:\n  // - January 12 - 19\n  // - January 12 - February 3\n  static formatWeekRange(range) {\n    const today = moment()\n    let fromFormat = 'MMMM D'\n    let toFormat = 'MMMM D'\n\n    if (range.from.month() === range.to.month()) {\n      toFormat = 'D'\n    }\n\n    const fromDate = range.from.format(fromFormat)\n    const toDate = range.to.format(toFormat)\n\n    return `${fromDate} - ${toDate}`\n  }\n\n  get filtered() {\n    return this._filtered\n  }\n\n  set filtered(value) {\n    this._filtered = value\n    this.aside.innerText = value\n    this.list.filter()\n  }\n\n  get env() {\n    if (this._env) return this._env\n\n    this._env = 'dev'\n\n    if (location.hostname === 'planner-6059a.firebaseapp.com') {\n      this._env = 'prod'\n    }\n\n    return this._env\n  }\n\n  get config() {\n    if (this._config) return this._config\n\n    const configs = {\n      dev: {\n        apiKey: \"AIzaSyAqvyzUD5ioSwBSkj1zd61a_LipptjQb0M\",\n        authDomain: \"planner-dev-73d1e.firebaseapp.com\",\n        databaseURL: \"https://planner-dev-73d1e.firebaseio.com\",\n        storageBucket: \"\",\n      },\n\n      prod: {\n        apiKey: \"AIzaSyBgNTLh6iZ8itiE0-JaJJqlyUJ4aW4rB3c\",\n        authDomain: \"planner-6059a.firebaseapp.com\",\n        databaseURL: \"https://planner-6059a.firebaseio.com\",\n        storageBucket: \"\",\n      }\n    }\n\n    this._config = configs[this.env]\n\n    return this._config\n  }\n\n  firebase() {\n    const anHourAgo = moment().subtract(1, 'hour')\n    const awaitingAuthRedirect = sessionStorage.getItem('awaitingAuthRedirect')\n\n    let isAwaitingAuthRedirect = false\n    if (awaitingAuthRedirect) {\n      isAwaitingAuthRedirect = moment(awaitingAuthRedirect).isAfter(anHourAgo)\n      sessionStorage.removeItem('awaitingAuthRedirect')\n    }\n\n    firebase.initializeApp(this.config)\n\n    return new Promise((resolve, reject) => {\n\n      firebase.auth().onAuthStateChanged(user => {\n        if (user || !isAwaitingAuthRedirect) {\n          resolve()\n        } else {\n          firebase.auth().getRedirectResult().then(resolve).catch(error => {\n            resolve() // TODO - show a notice?\n          })\n        }\n      })\n\n    })\n  }\n\n  signIn(provider) {\n    this.modal.dataset.active = '#loading'\n    sessionStorage.setItem('awaitingAuthRedirect', moment().format())\n    const authProvider = new firebase.auth[provider]()\n    firebase.auth().signInWithRedirect(authProvider)\n  }\n\n  signOut() {\n    firebase.auth().signOut()\n    this.list.unload()\n\n    const settings = this.el.querySelector('.settings')\n    const profile = this.el.querySelector('.profile')\n\n    settings.innerText = ''\n    profile.innerText = ''\n\n    settings.removeAttribute('style')\n    profile.removeAttribute('style')\n\n    this.modal.dataset.active = '#providers'\n  }\n\n  loading() {\n    this.modal.dataset.active = '#loading'\n  }\n\n  init() {\n    const user = firebase.auth().currentUser\n\n    if (user) {\n      const settings = this.el.querySelector('.settings')\n      const profile = this.el.querySelector('.profile')\n      const letter = user.displayName ? user.displayName[0] : '?'\n\n      settings.innerText = letter\n      profile.innerText = letter\n\n      if (user.photoURL) {\n        settings.style.backgroundImage = `url(${user.photoURL})`\n        profile.style.backgroundImage = `url(${user.photoURL})`\n      }\n\n      this.db = firebase.database().ref(`users/${user.uid}/items`)\n\n      const ref = this.db.orderByChild('order')\n\n      ref.on('child_added', data => {\n        this.list.loadItem(data.key, data.val())\n\n        if (this.modal.dataset.active === '#loading') {\n          this.modal.dataset.active = ''\n        }\n      })\n\n      ref.on('child_changed', data => {\n        this.list.updateItem(data.key, data.val())\n      })\n\n      ref.on('child_removed', data => {\n        this.list.removeItem(data.key, data.val())\n      })\n    } else {\n      this.modal.dataset.active = '#providers'\n    }\n  }\n\n  build() {\n    this.buildAside()\n    this.buildModal()\n  }\n\n  buildAside() {\n    this.aside = document.createElement('aside')\n\n    this.el.appendChild(this.aside)\n  }\n\n  buildModal() {\n    this.modal = document.createElement('div')\n    this.modal.classList.add('modal')\n\n    this.buildModalLoading()\n    this.buildModalProviders()\n    this.buildModalSettings()\n\n    this.el.appendChild(this.modal)\n  }\n\n  buildModalLoading() {\n    const section = document.createElement('section')\n    const div = document.createElement('div')\n\n    section.dataset.id = 'loading'\n    div.classList.add('loading')\n    section.appendChild(div)\n\n    this.modal.appendChild(section)\n  }\n\n  buildModalProviders() {\n    const section = document.createElement('section')\n\n    section.dataset.id = 'providers'\n\n    const a = document.createElement('a')\n    const img = document.createElement('img')\n    img.src = `/google.svg`\n    a.classList.add('provider')\n    a.appendChild(img)\n    section.appendChild(a)\n\n    a.addEventListener('singletap', e => {\n      this.signIn('GoogleAuthProvider')\n    })\n\n    this.modal.appendChild(section)\n  }\n\n  buildModalSettings() {\n    const section = document.createElement('section')\n    const close = document.createElement('a')\n    const profile = document.createElement('div')\n    const signOut = document.createElement('button')\n\n    close.classList.add('close')\n    profile.classList.add('profile')\n    signOut.innerText = 'Sign out'\n    section.dataset.id = 'settings'\n    section.appendChild(close)\n    section.appendChild(profile)\n    section.appendChild(signOut)\n\n    close.addEventListener('singletap', e => {\n      this.list.app.modal.dataset.active = ''\n    })\n\n    signOut.addEventListener('singletap', e => {\n      this.signOut()\n    })\n\n    this.modal.appendChild(section)\n  }\n\n  hammer() {\n    this.hammer = new Hammer.Manager(this.el, { domEvents: true })\n\n    const singleTap = new Hammer.Tap({ event: 'singletap', taps: 1 })\n    const doubleTap = new Hammer.Tap({ event: 'doubletap', taps: 2 })\n\n    this.hammer.add(doubleTap)\n    this.hammer.add(singleTap)\n  }\n\n  observe() {\n\n    // For regular keys, use `keypress` (provides the correct char code)\n    window.addEventListener('keypress', e => {\n      if (this.editing) return\n      if (e.metaKey) return\n      if (e.ctrlKey) return\n      if (e.altKey) return\n      if (e.which === 13) return\n\n      const char = String.fromCharCode(e.which)\n\n      if (!char) return\n\n      this.filtered += char\n    })\n\n    // For special keys (esc and backspace), use `keydown`\n    window.addEventListener('keydown', e => {\n      if (this.editing) return\n      if (e.metaKey) return\n      if (e.ctrlKey) return\n      if (e.altKey) return\n      if (e.shiftKey) return\n\n      if (e.which === 27) { // Esc\n        e.preventDefault()\n\n        if (this.modal.dataset.active === '#settings') {\n          this.modal.dataset.active = ''\n        }\n\n        if (document.activeElement) {\n          document.activeElement.blur()\n        }\n\n        this.filtered = ''\n        if (this.list.drake.dragging) {\n          this.list.drake.cancel(true)\n          if (this.list.originalSectionId) {\n            this.list.el.dataset.active = `#${this.list.originalSectionId}`\n          }\n        }\n      }\n\n      if (e.which === 8) { // Backspace\n        e.preventDefault()\n        this.filtered = this.filtered.slice(0, this.filtered.length - 1)\n      }\n    })\n\n  }\n\n  load(cached) {\n    const orders = {}\n\n    const updates = cached.reduce((items, item) => {\n      let section = this.list.sectionById[item.group]\n\n      if (!section) {\n        section = this.list.sectionById.overdue\n      }\n\n      if (!(section.id in orders)) {\n        orders[section.id] = 0\n      }\n\n      const ref = this.list.app.db.push()\n\n      items[ref.key] = {\n        group: section.id,\n        content: '',\n        order: ++orders[section.id]\n      }\n\n      return items\n    }, {})\n\n    this.db.update(updates)\n  }\n\n}\n\n// Can have multiple lists, but only one is active\n// Lists hold all the items within\nclass List {\n\n  constructor(opts) {\n    if (opts.name) this.name = opts.name\n    this.app = opts.app\n    this.el = document.createElement('main')\n    this.items = {}\n  }\n\n  build() {\n    this.sections = [] // Ordered, for rendering sequentially\n    this.sectionById = {} // For easy lookup\n\n    const date = moment().startOf('day').subtract(1, 'day')\n    const days = ['today', 'tomorrow', 'day-after-tomorrow']\n\n    // Sundays are skipped, so if today is Sunday, pretend it's Saturday\n    if (moment().day() === 0) date.subtract(1, 'day')\n\n    this.el.dataset.active = ''\n\n    days.forEach(day => {\n      date.add(1, 'days')\n\n      if (date.day() === 0) {\n        // Skip Sundays\n        date.add(1, 'days')\n      }\n\n      const section = new DaySection({\n        list: this,\n        date: date,\n        sectionId: day\n      })\n\n      section.build()\n      section.render(this.el)\n\n      this.sections.push(section)\n      this.sectionById[section.id] = section\n    })\n\n\n    const sectionClasses = [ WeekSection, MonthSection, BacklogSection, OverdueSection, DoneSection ]\n\n    sectionClasses.forEach(SectionClass => {\n      const section = new SectionClass({\n        list: this\n      })\n\n      section.build()\n      section.render(this.el)\n\n      this.sections.push(section)\n      this.sectionById[section.id] = section\n    })\n\n    this.dragula()\n\n    return this\n  }\n\n  dragula() {\n    const lists = this.sections.map(section => { return section.listEl })\n    const headers = this.sections.map(section => { return section.header })\n    const els = [...lists, ...headers]\n\n    this.drake = dragula({\n      containers: els,\n      mirrorContainer: this.el,\n      moves: (el, source, handle, sibling) => {\n        if (source.nodeName === 'HEADER') {\n          return false\n        }\n\n        if (!App.canDrag) {\n          return false\n        }\n\n        const item = this.items[el.dataset.key]\n\n        if (item.editing) {\n          return false\n        }\n\n        return true\n      },\n      accepts: (el, target, source, sibling) => {\n        const section = this.sectionById[target.parentElement.dataset.id]\n        const active = section.list.el.querySelector('section.over')\n\n        if (active) {\n          active.classList.remove('over')\n        }\n\n        section.el.classList.add('over')\n        this.el.dataset.active = `#${section.sectionId}`\n\n        if (target.nodeName === 'HEADER') {\n          if (target.parentElement === el.parentElement.parentElement) {\n            return false\n          }\n\n          section.listEl.insertBefore(el, section.listEl.firstChild)\n\n          return false\n        }\n\n        return true\n      }\n    })\n\n    this.drake.on('drag', (el) => {\n      this.originalSectionId = el.parentElement.parentElement.dataset.sectionId\n      el.parentElement.parentElement.classList.add('over')\n    })\n\n    this.drake.on('dragend', (el) => {\n      const active = this.el.querySelector('section.over')\n\n      if (active) {\n        active.classList.remove('over')\n      }\n    })\n\n    this.drake.on('drop', (el, target, source, sibling) => {\n      const item = this.items[el.dataset.key]\n      const section = this.sectionById[target.parentElement.dataset.id]\n      item.section = section\n    })\n\n    this.drake.on('cloned', (clone, original, type) => {\n      const color = getComputedStyle(original).backgroundColor\n      clone.style.boxShadow = `inset 0 0 0 50vw ${color}`\n    })\n\n    this.drake.on('shadow', (el, container, source) => {\n      const mirror = this.el.querySelector('.item.gu-mirror')\n      mirror.dataset.sectionType = container.parentElement.dataset.name\n    })\n  }\n\n  loadItem(key, attrs) {\n    const item = new Item({\n      key: key,\n      section: this.sectionById[attrs.group],\n      content: attrs.content,\n      order: attrs.order\n    })\n\n    item.build()\n    item.section.reorderToDOM()\n  }\n\n  updateItem(key, attrs) {\n    const item = this.items[key]\n\n    item.update(attrs)\n  }\n\n  removeItem(key, attrs) {\n    const item = this.items[key]\n\n    item.detach()\n\n    delete this.items[key]\n  }\n\n  unload() {\n    const keys = Object.keys(this.items)\n\n    keys.forEach(key => {\n      const item = this.items[key]\n\n      item.detach()\n\n      delete this.items[key]\n    })\n  }\n\n  render() {\n    this.app.el.appendChild(this.el)\n  }\n\n  filter() {\n    const regex = new RegExp(App.escapeRegex(this.app.filtered), 'i')\n\n    Object.keys(this.items).forEach(key => {\n      const item = this.items[key]\n\n      if (regex.test(item.content)) {\n        item.show()\n      } else {\n        item.hide()\n      }\n    })\n  }\n\n}\n\n// Represents a visual group, and is where items get rendered\nclass Section {\n\n  constructor(opts) {\n    this.id = opts.id || opts.name\n    this.list = opts.list\n    this.name = opts.name\n    this.title = opts.name\n    this.sectionId = opts.sectionId\n    this.classes = new Set()\n    this.classes.add(opts.name)\n    this.classes.add(opts.sectionId)\n  }\n\n  get items() {\n    const keys = Object.keys(this.list.items)\n\n    return keys.reduce((items, key) => {\n      const item = this.list.items[key]\n\n      if (item.section === this) {\n        items.push(item)\n      }\n\n      return items\n    }, []).sort((a, b) => {\n      return a.order - b.order\n    })\n  }\n\n  build() {\n    const section = document.createElement('section')\n    const header = document.createElement('header')\n    const back = document.createElement('button')\n    const list = document.createElement('div')\n    section.appendChild(header)\n    section.appendChild(list)\n\n    section.dataset.id = this.id\n    section.dataset.name = this.name\n    section.dataset.sectionId = this.sectionId\n    this.classes.forEach(className => {\n      section.classList.add(className)\n    })\n\n    const emoji = this.emoji()\n    if (emoji) header.dataset.emoji = emoji\n    header.innerText = this.title\n    back.classList.add('back')\n    list.classList.add('list')\n    header.appendChild(back)\n\n    this.el = section\n    this.header = header\n    this.listEl = list\n\n    this.el.addEventListener('doubletap', e => {\n      if (e.target !== this.listEl && e.target !== this.header) return\n\n      const first = e.target !== this.listEl\n      const opts = {}\n\n      opts.section = this\n\n      if (first) {\n        opts.order = 1\n        this.reorderFromIndex(2)\n      } else {\n        opts.order = this.items.length + 1\n      }\n\n      Item.create(this, opts)\n    })\n\n    header.addEventListener('singletap', e => {\n      if (e.target !== header) return\n\n      this.list.el.dataset.active = `#${this.sectionId}`\n    })\n\n    back.addEventListener('singletap', e => {\n      if (e.target !== back) return\n\n      this.list.el.dataset.active = ''\n    })\n\n    return this\n  }\n\n  emoji() {\n\n  }\n\n  render(parent) {\n    parent.appendChild(this.el)\n  }\n\n  reorderFromIndex(index) {\n    this.items.reduce((n, item) => {\n      item.order = n\n\n      return ++n\n    }, index)\n  }\n\n  reorderFromDOM() {\n    const els = this.el.querySelectorAll('.item:not(.gu-mirror)')\n    const keys = [...els].map(el => { return el.dataset.key })\n    const items = keys.map(key => { return this.list.items[key] })\n\n    items.reduce((n, item) => {\n      item.order = n\n\n      return ++n\n    }, 1)\n  }\n\n  reorderToDOM() {\n    this.items.forEach(item => {\n      item.detach()\n      item.render()\n    })\n  }\n\n}\n\nclass DaySection extends Section {\n\n  constructor(opts) {\n    const date = opts.date\n    const today = moment().startOf('day')\n\n    if (today.day() === 0) {\n      today.subtract(1, 'day')\n    }\n\n    const isToday = date.isSame(today)\n    const isSaturday = date.day() === 6\n\n    opts.id = date.format('YYYY-MM-DD')\n    opts.name = 'day'\n    super(opts)\n\n    this.date = date\n    this.title = date.format('dddd')\n\n    if (isSaturday) {\n      this.classes.add('weekend')\n    }\n\n    if (isToday && isSaturday) {\n      this.title = 'This weekend'\n    } else if (isToday) {\n      this.title = 'Today'\n    } else if (isSaturday) {\n      this.title = 'Weekend'\n    }\n  }\n\n  build() {\n    super.build()\n\n    const today = moment().startOf('day')\n    let day = this.date.format('dddd')\n\n    if (today.day() === 0) {\n      today.subtract(1, 'day')\n    }\n\n    if (this.date.isSame(today)) {\n      day = 'today'\n    }\n\n    if (this.date.day() === 6) {\n      day = 'the weekend'\n    }\n\n    this.listEl.dataset.day = day\n\n    if (this.date.isSame(today)) {\n      const settings = document.createElement('a')\n\n      settings.classList.add('settings')\n\n      settings.addEventListener('singletap', e => {\n        this.list.app.modal.dataset.active = '#settings'\n      })\n\n      this.header.appendChild(settings)\n    }\n\n    return this\n  }\n\n}\n\nclass WeekSection extends Section {\n\n  constructor(opts) {\n    const dateStart = moment().startOf('week')\n    const dateEnd = moment().endOf('week')\n\n    opts.id = `${dateStart.format('YYYY-MM-DD')}-${dateEnd.format('YYYY-MM-DD')}`\n    opts.name = 'week'\n    opts.sectionId = 'week'\n    super(opts)\n\n    this.title = 'This week'\n  }\n\n  build() {\n    const dateStart = moment().startOf('week')\n    const dateEnd = moment().endOf('week')\n\n    super.build()\n\n    this.listEl.dataset.dates = App.formatWeekRange({ from: dateStart, to: dateEnd })\n\n    return this\n  }\n\n}\n\nclass MonthSection extends Section {\n\n  constructor(opts) {\n    const dateStart = moment().startOf('month')\n    const dateEnd = moment().endOf('month')\n\n    opts.id = `${dateStart.format('YYYY-MM-DD')}-${dateEnd.format('YYYY-MM-DD')}`\n    opts.name = 'month'\n    opts.sectionId = 'month'\n    super(opts)\n\n    this.title = 'This month'\n  }\n\n  build() {\n    const date = moment()\n\n    super.build()\n\n    this.listEl.dataset.date = date.format('MMMM')\n\n    return this\n  }\n\n}\n\nclass DoneSection extends Section {\n\n  constructor(opts) {\n    opts.name = 'done'\n    opts.sectionId = 'done'\n    super(opts)\n  }\n\n  emoji() {\n    return '😍'\n  }\n\n  build() {\n    super.build()\n\n    const button = document.createElement('button')\n\n    button.classList.add('clear')\n    button.innerText ='Clear'\n    this.el.appendChild(button)\n\n    button.addEventListener('singletap', e => {\n      this.clear()\n    })\n\n    return this\n  }\n\n  clear() {\n    Object.keys(this.list.items).forEach(key => {\n      const item = this.list.items[key]\n      if (item.section.id === this.id) {\n        item.remove()\n      }\n    })\n  }\n\n}\n\nclass OverdueSection extends Section {\n\n  constructor(opts) {\n    opts.name = 'overdue'\n    opts.sectionId = 'overdue'\n    super(opts)\n  }\n\n  emoji() {\n    return '😰'\n  }\n\n}\n\nclass BacklogSection extends Section {\n\n  constructor(opts) {\n    opts.name = 'backlog'\n    opts.sectionId = 'backlog'\n    super(opts)\n  }\n\n}\n\n// Items have an ID (not persisted) and text content and belong to a section\nclass Item {\n\n  constructor(opts) {\n    this._section = opts.section\n    this._content = opts.content\n    this.list = this._section.list\n    this._order = opts.order\n    this.key = opts.key\n\n    this._editing = this.list.editing === this.key\n    this.list.items[this.key] = this\n\n    // Explicit bindings\n    this.onDblClick = this.onDblClick.bind(this)\n    this.onKeydown = this.onKeydown.bind(this)\n    this.onBlur = this.onBlur.bind(this)\n    this.onPaste = this.onPaste.bind(this)\n    this.onTouchStart = this.onTouchStart.bind(this)\n    this.onTouchMove = this.onTouchMove.bind(this)\n    this.onTouchEnd = this.onTouchEnd.bind(this)\n    this.onMouseMove = this.onMouseMove.bind(this)\n  }\n\n  static create(section, opts) {\n    const ref = opts.section.list.app.db.push()\n\n    section.list.editing = ref.key\n\n    ref.set({\n      group: opts.section.id,\n      content: '',\n      order: opts.order\n    })\n\n    return ref\n  }\n\n  get editing () {\n    return this._editing\n  }\n\n  set editing(value) {\n    this._editing = value\n    this.list.app.editing = value ? this.key : null\n  }\n\n  get order() {\n    return this._order\n  }\n\n  set order(value) {\n    const previous = this._order\n\n    this._order = value\n\n    if (previous !== value) {\n      this.updateOrder()\n    }\n  }\n\n  get section () {\n    return this._section\n  }\n\n  set section(value) {\n    const previous = this._section\n\n    if (!value) {\n      value = this.list.sectionById.overdue\n    }\n\n    this._section = value\n    this.el.dataset.sectionId = value.name\n\n    if (!previous) {\n      return\n    }\n\n    if (previous !== value) {\n      this.updateSection()\n      previous.reorderFromDOM()\n      value.reorderFromDOM()\n    } else {\n      value.reorderFromDOM()\n    }\n  }\n\n  get content() {\n    return this._content\n  }\n\n  set content(value) {\n    const previous = this._content\n\n    this._content = value\n\n    if (previous !== value) {\n      this.updateContent()\n    }\n  }\n\n  toJSON() {\n    return {\n      group: this.section.id,\n      content: this.content,\n      order: this.order\n    }\n  }\n\n  build() {\n    const el = document.createElement('article')\n\n    el.classList.add('item')\n    el.dataset.sectionType = this.section.name\n    el.dataset.key = this.key\n    el.innerHTML = App.markdown(this.content)\n    el.tabIndex = 1\n\n    el.addEventListener('keydown', this.onKeydown)\n\n    this.el = el\n\n    if (this.editing) {\n      this.startEditing()\n    } else {\n      this.awaitEditing()\n    }\n\n    return this\n  }\n\n  render() {\n    this.section.listEl.appendChild(this.el)\n\n    if (this.editing) {\n      this.el.focus()\n    }\n  }\n\n  update(attrs) {\n    let section = this.list.sectionById[attrs.group]\n\n    if (this.content !== attrs.content) {\n      this._content = attrs.content\n      this.el.innerHTML = App.markdown(this._content)\n    }\n\n    if (this.order !== attrs.order) {\n      this._order = attrs.order\n      this.section.reorderToDOM()\n    }\n\n    if (this.section !== section) {\n      const prev = this.section\n      this.detach()\n      this._section = section\n      section.reorderToDOM()\n    }\n  }\n\n  detach() {\n    if (!this.el.parentElement) return\n    this.section.listEl.removeChild(this.el)\n  }\n\n  remove() {\n    // this.detach()\n    // delete this.list.items[this.key]\n    // this.section.reorderFromDOM()\n    this.delete()\n  }\n\n  show() {\n    this.el.style.display = ''\n  }\n\n  hide() {\n    this.el.style.display = 'none'\n  }\n\n  startEditing() {\n    this.editing = true\n    this.el.contentEditable = 'true'\n    this.el.innerText = this.content\n\n    if (this.el.parentElement) {\n      this.focus() // Ensure cursor is at end\n    } else {\n      this.el.focus()\n    }\n\n    this.el.removeEventListener('doubletap', this.onDblClick)\n    this.el.removeEventListener('touchstart', this.onTouchStart)\n    this.el.removeEventListener('touchmove', this.onTouchMove)\n    this.el.removeEventListener('touchend', this.onTouchEnd)\n    this.el.removeEventListener('touchcancel', this.onTouchEnd)\n    this.el.removeEventListener('mousedown', this.onMouseMove)\n    this.el.addEventListener('blur', this.onBlur)\n    this.el.addEventListener('paste', this.onPaste)\n  }\n\n  finishEditing() {\n    this.editing = false\n    this.el.contentEditable = 'false'\n    this.el.removeEventListener('blur', this.onBlur)\n    this.el.removeEventListener('paste', this.onPaste)\n\n    const content = this.el.innerText\n\n    if (content.replace(/\\s/g, '')) {\n      this.content = content\n    } else {\n      return this.remove()\n    }\n\n    this.awaitEditing()\n  }\n\n  cancelEditing() {\n    this.el.innerText = this.content\n    this.finishEditing()\n  }\n\n  awaitEditing() {\n    this.el.addEventListener('doubletap', this.onDblClick)\n    this.el.addEventListener('touchstart', this.onTouchStart)\n    this.el.addEventListener('touchmove', this.onTouchMove)\n    this.el.addEventListener('touchend', this.onTouchEnd)\n    this.el.addEventListener('touchcancel', this.onTouchEnd)\n    this.el.addEventListener('mousedown', this.onMouseMove)\n  }\n\n  updateOrder() {\n    const ref = this.list.app.db.child(this.key)\n    ref.update({ order: this.order })\n  }\n\n  updateSection() {\n    const ref = this.list.app.db.child(this.key)\n    ref.update({ group: this.section.id })\n  }\n\n  updateContent() {\n    const ref = this.list.app.db.child(this.key)\n    ref.update({ content: this.content })\n  }\n\n  delete() {\n    const ref = this.list.app.db.child(this.key)\n    ref.remove()\n  }\n\n  focus() {\n    this.el.focus()\n    const range = document.createRange()\n    range.selectNodeContents(this.el)\n    range.collapse(false)\n    const selection = window.getSelection()\n    selection.removeAllRanges()\n    selection.addRange(range)\n  }\n\n  onDblClick(e) {\n    this.startEditing()\n  }\n\n  onKeydown(e) {\n    if (e.which === 13 && !e.shiftKey) e.preventDefault()\n\n    if (this.editing) {\n      if (e.which === 27) this.cancelEditing() // Esc\n      if (e.which === 13 && !e.shiftKey) this.el.blur() // Enter\n    } else {\n      if (e.which === 13) this.startEditing() // Enter\n    }\n  }\n\n  onBlur(e) {\n    this.finishEditing()\n  }\n\n  onPaste(e) {\n    e.stopPropagation()\n    e.preventDefault()\n\n    const clipboardData = e.clipboardData || window.clipboardData\n    const pastedData = clipboardData.getData('Text')\n    const selection = window.getSelection()\n    const range = selection.getRangeAt(0)\n\n    range.deleteContents()\n    range.insertNode(document.createTextNode(pastedData))\n    this.focus()\n  }\n\n  onTouchStart(e) {\n    if ('_allowDrag' in this) return\n\n    App.canDrag = false\n\n    this._timer = setTimeout(() => {\n      this._allowDrag = App.canDrag = true\n      this.el.dispatchEvent(e)\n      delete this._allowDrag\n    }, 500)\n  }\n\n  onTouchMove(e) {\n    clearTimeout(this._timer)\n  }\n\n  onTouchEnd(e) {\n    clearTimeout(this._timer)\n  }\n\n  onMouseMove(e) {\n    clearTimeout(this._timer)\n    App.canDrag = true\n  }\n\n}\n\nconst app = new App()\n"]}